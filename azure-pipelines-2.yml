trigger:
  branches:
    include:
    - main
  paths:
    include:
    - src/backend/AzFunctions/CloudNinjaFunctions 

pool:
  vmImage: 'ubuntu-latest'

variables:
  azureSubscription: 'AZR'  # Use your existing service connection
  containerRegistry: 'dersimabbas.azurecr.io'
  functionsDockerfilePath: 'CloudNinjaFunctions/Dockerfile'  # Adjust to your function app folder path
  functionsImageName: 'cloudNinja-Function'
  tag: 'latest'

stages:
- stage: Build
  displayName: 'Build and Push Azure Functions Docker image'
  jobs:
  - job: BuildAndPush
    displayName: 'Build and push Azure Functions docker image'
    steps:
      - task: Docker@2
        displayName: 'Login to ACR'
        inputs:
          command: login
          containerRegistry: $(azureSubscription)

      - task: Docker@2
        displayName: 'Build and push Azure Functions image'
        inputs:
          command: buildAndPush
          repository: $(functionsImageName)
          dockerfile: $(functionsDockerfilePath)
          containerRegistry: $(azureSubscription)
          tags: |
            $(tag)
           